<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:beans="http://www.springframework.org/schema/beans"
    xmlns:sec="http://www.springframework.org/schema/security"
    xsi:schemaLocation="
        http://www.springframework.org/schema/security
        http://www.springframework.org/schema/security/spring-security-3.2.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.2.xsd">

	<http auto-config="false"
		entry-point-ref="authenticationProcessingFilterEntryPoint"
		use-expressions="true">
		<intercept-url pattern="/**/loginRedirect.html*"
			access="hasAnyRole('ROLE_SHOP_CRUD','ROLE_TIMESHEET','ROLE_SHOP_MGR','ROLE_SHOP_OWNER','ROLE_PAYROLL','ROLE_SUPREME','ROLE_ACCOUNTANT','ROLE_DSM','ROLE_CSC','ROLE_DAILY_SALES', 'ROLE_RECEPTION','ROLE_CRV')"
			requires-channel="http" />
		<intercept-url pattern="/**/documentation.html*"
			access="hasAnyRole('ROLE_SHOP_CRUD','ROLE_TIMESHEET','ROLE_SHOP_MGR','ROLE_SHOP_OWNER','ROLE_PAYROLL','ROLE_SUPREME','ROLE_ACCOUNTANT','ROLE_DSM','ROLE_DAILY_SALES', 'ROLE_RECEPTION')"
			requires-channel="http" />
		<intercept-url pattern="/**/*.pdf*"
			access="hasAnyRole('ROLE_SHOP_CRUD','ROLE_TIMESHEET','ROLE_SHOP_MGR','ROLE_SHOP_OWNER','ROLE_PAYROLL','ROLE_SUPREME','ROLE_ACCOUNTANT','ROLE_DSM','ROLE_DAILY_SALES', 'ROLE_RECEPTION')"
			requires-channel="http" />
		<intercept-url pattern="/**/employeeList*"
			access="hasAnyRole('ROLE_SHOP_CRUD','ROLE_TIMESHEET','ROLE_SHOP_MGR','ROLE_SHOP_OWNER','ROLE_PAYROLL','ROLE_SUPREME','ROLE_DSM')"
			requires-channel="http"></intercept-url>
		<intercept-url pattern="/**/employee.html*"
			access="hasAnyRole('ROLE_SHOP_CRUD','ROLE_SHOP_MGR','ROLE_SHOP_OWNER','ROLE_PAYROLL','ROLE_SUPREME','ROLE_DSM')"
			requires-channel="http" />
		<intercept-url pattern="/**/employeeRoles.html*" access="hasAnyRole('ROLE_SUPREME')"
			requires-channel="http" />
		<intercept-url pattern="/**/employeeUpdate.html*" access="hasAnyRole('ROLE_SUPREME','ROLE_PAYROLL')"
			requires-channel="http" />
		<intercept-url pattern="/**/employee*Change.html*"
			access="hasAnyRole('ROLE_SUPREME','ROLE_PAYROLL')" requires-channel="http" />
		<intercept-url pattern="/**/payrollAdmin.html*"
			access="hasAnyRole('ROLE_SUPREME','ROLE_PAYROLL')" requires-channel="http" />
		<intercept-url pattern="/**/shopsSettings.html*" access="hasAnyRole('ROLE_SUPREME')"
			requires-channel="http" />
		<intercept-url pattern="/**/posreport.html*" access="hasAnyRole('ROLE_SUPREME','ROLE_SHOP_OWNER')"
			requires-channel="http" />
		<intercept-url pattern="/**/driverList*"
			access="hasAnyRole('ROLE_SHOP_CRUD','ROLE_TIMESHEET','ROLE_SHOP_MGR','ROLE_SHOP_OWNER','ROLE_PAYROLL','ROLE_SUPREME')"
			requires-channel="http" />
		<intercept-url pattern="/**/driver*"
			access="hasAnyRole('ROLE_SHOP_CRUD','ROLE_SHOP_MGR','ROLE_SHOP_OWNER','ROLE_PAYROLL','ROLE_SUPREME')"
			requires-channel="http" />
		<intercept-url pattern="/**/payroll.html*"
			access="hasAnyRole('ROLE_TIMESHEET','ROLE_SHOP_MGR','ROLE_SHOP_OWNER','ROLE_PAYROLL','ROLE_SUPREME')"
			requires-channel="http" />
		<intercept-url pattern="/**/payrollSearch.html*"
			access="hasAnyRole('ROLE_TIMESHEET','ROLE_SHOP_MGR','ROLE_SHOP_OWNER','ROLE_PAYROLL','ROLE_SUPREME','ROLE_ACCOUNTANT','ROLE_DSM')"
			requires-channel="http" />
		<intercept-url pattern="/**/payrollView.html*"
			access="hasAnyRole('ROLE_TIMESHEET','ROLE_SHOP_MGR','ROLE_SHOP_OWNER','ROLE_PAYROLL','ROLE_SUPREME','ROLE_ACCOUNTANT','ROLE_DSM')"
			requires-channel="http" />
		<intercept-url pattern="/**/payrollExport.html*"
			access="hasAnyRole('ROLE_PAYROLL','ROLE_SUPREME')" requires-channel="http" />
		<intercept-url pattern="/**/exportPayroll.html*"
			access="hasAnyRole('ROLE_PAYROLL','ROLE_SUPREME')" requires-channel="http" />
		<intercept-url pattern="/**/exportexportShopTotals.html*"
			access="hasAnyRole('ROLE_PAYROLL','ROLE_SUPREME')" requires-channel="http"></intercept-url>
		<intercept-url pattern="/**/dailySales*.html*"
			access="hasAnyRole('ROLE_SHOP_OWNER','ROLE_ACCOUNTANT','ROLE_SUPREME','ROLE_DAILY_SALES','ROLE_RECEPTION','ROLE_DSM')"
			requires-channel="http" />
		<intercept-url pattern="/**/weeklySales*.html*"
			access="hasAnyRole('ROLE_SHOP_OWNER','ROLE_ACCOUNTANT','ROLE_SUPREME','ROLE_DAILY_SALES','ROLE_RECEPTION','ROLE_DSM')"
			requires-channel="http" />
		<intercept-url pattern="/**/complaint*.html*"
			access="hasAnyRole('ROLE_SHOP_OWNER','ROLE_SUPREME','ROLE_CSC','ROLE_DSM','ROLE_CRV')"
			requires-channel="http" />
		<intercept-url pattern="/**" requires-channel="http" />
		<logout logout-url="/logout.html" invalidate-session="true"
			logout-success-url="/login.html" />

        <http-basic />
        <anonymous/>

        <custom-filter position="FORM_LOGIN_FILTER" ref="adminAuthenticationProcessingFilter" />


	</http>

	<authentication-manager alias="authenticationManagerAlias">
		<authentication-provider user-service-ref="employeeDao" />
	</authentication-manager>

	<beans:bean id="lookupManager" class="com.pizza73.service.impl.LookupManagerImpl" />

    <beans:bean id="authenticationProcessingFilterEntryPoint"
        class="org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint" >
        <!-- <beans:constructor-arg index="0"><beans:value>/login.html</beans:value></beans:constructor-arg> -->
        <beans:property name="loginFormUrl" value="/login.html" />
        <beans:property name="forceHttps" value="true" />
    </beans:bean>

	<beans:bean id="adminAuthenticationProcessingFilter"
		class="com.pizza73.webapp.filter.Pizza73AuthenticationProcessingFilter">
		<beans:property name="authenticationManager" ref="authenticationManagerAlias" />
		<beans:property name="lookupManager" ref="lookupManager" />
		<beans:property name="authenticationFailureHandler" ref="failureHandler" />
        <beans:property name="authenticationSuccessHandler" ref="successHandler" />
		<beans:property name="filterProcessesUrl" value="/loginProcessing.html" />
	</beans:bean>

	<beans:bean id="successHandler" class="org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler" >
        <beans:property name="defaultTargetUrl" value="/loginRedirect.html" />
    </beans:bean>
    <beans:bean id="failureHandler" class="org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler" >
        <beans:property name="defaultFailureUrl" value="/login.html?error=true" />
    </beans:bean>

</beans:beans>
